#+TITLE: Mail

:SOURCE:
Adapted from [[https://github.com/daviwil/dotfiles.git][daviwil/dotfiles]].
:END:

* Mail Synchronization

Configuration docs: https://manpages.debian.org/unstable/isync/mbsync.1.en.html

#+begin_src conf :tangle .mbsyncrc

IMAPAccount mailbox
Host imap.mailbox.org
Port 993
User jpieper@mailbox.org
PassCmd "emacsclient -e \"(jp/lookup-password :host \\\"imap.mailbox.org\\\" :user \\\"jpieper@mailbox.org\\\")\" | cut -d '\"' -f2"
SSLType IMAPS
SSLVersions TLSv1.2
#+end_src

For Linux and MacOS the certificates are at different places.

- This configuration is for Linux:
  #+begin_src conf :tangle (cond ((eq system-type 'gnu/linux) ".mbsyncrc") ((eq system-type 'darwin) "no"))
CertificateFile /etc/ssl/cert.pem
  #+end_src

- This configuration is for MacOS:
  #+begin_src conf :tangle (cond ((eq system-type 'darwin) ".mbsyncrc") ((eq system-type 'gnu/linux) "no"))
CertificateFile ~/Mail/certificates/root-certificates.pem
  #+end_src


#+begin_src conf :tangle .mbsyncrc

# Define the remote from which mail will be synced
IMAPStore mailbox-remote
Account mailbox

# Define where mail will be stored
MaildirStore mailbox-local
Path ~/Mail/Mailbox/
Inbox ~/Mail/Mailbox/INBOX/
Trash ~/Mail/Mailbox/Trash/
SubFolders Verbatim

# Connect the remote and the local maildir
Channel mailbox
Master :mailbox-remote:
Slave :mailbox-local:
Patterns * !"Archive/*"
Expunge None
CopyArrivalDate yes
Sync All
Create Near
SyncState *

#+end_src
